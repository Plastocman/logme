Stuck with legacy code ? Fear not, logme is here.

# Python code injection

This module will hook on imports, catch the syntax tree generated by the parser and rewrite it before yielding it to the compiler, therefore modifying your code behavior without changing the sources. 

It's mainly useful for debugging/testing big messy code bases, and not meant to be used in production.

For a great example of AST + import hooks use, see e.g. [fuckit](https://github.com/ajalt/fuckitpy)

## What does it do ?

The provided example does something very simple : it adds logging after every single exception handler. Every exception that is caught in your code will now be logged.

Whether it's useful or not depends mainly on your program flow but it can come in handy.

## How does it work ?

### import hooks

See [PEP 302](https://www.python.org/dev/peps/pep-0302/) and stdlib doc for import hooks. 

Basically you're patching the `import` statement, giving new methods for finding/loading modules in your program, which allows you to do pretty much everything you want to your sources before compiling them, like adding/removing lines of code e.g.

### AST 

The classes inheriting from NodeTransformer take a parse tree as input and modify it berore returning it. The modified syntax tree is then compiled into bytecode.

See [greentreesnakes](https://greentreesnakes.readthedocs.io/en/latest/) and the stdlibdoc for the AST.


## Usage

The tree_factory function will take a source code block (as a string) as input, and will return an ast Node corresponding to that code.

You can tweak is as you wish ; if you want to inject something else (a pdb, crash your program, whatever) just replace the given code template.

If you want to modify nodes other that exception handlers, you can write your own implementation of NodeTransformer.

Then just go to your program starting point and import the `import_hook` module.

## Caveats

Can take a bit extra time to start your program. 

Log files may be polluted by exceptions that are part of your program flow (you can blacklist some modules that raise too many exceptions, or add your own fix).

## Installation

Just git clone the repo, make your own source template, generate the Node and leave the rest to the ast NodeTransformer and the import hooks to inject it.

Pip install + script incoming

## Is it a good idea ? 

I don't know, you tell me. I found some actual use for this module so that's that.

## What's next ?

AST and import hooks make it really easy to create any code injection/modification lib/framework.

The possibilities are endless, and it's actually really fun. Feel free to contact me for anything (I'm by no means an expert but I'm interested).